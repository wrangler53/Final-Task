{"version":3,"sources":["app-module.js","authentification.js","findImagesService.js","map.js","sharing.js","uploadPhotoService.js","add-avatar-modal.js","popup.js","upload-photo-modal.js","about-controller.js","authorization-controller.js","cabinet-controller.js","contacts-controller.js","gallery-controller.js","home-controller.js","image-controller.js","registration-controller.js","root-controller.js","search-controller.js","user-controller.js","upload-photo.js"],"names":["appModule","angular","module","config","$stateProvider","$urlRouterProvider","state","url","templateUrl","controller","otherwise","service","$state","this","currentUser","authUser","user","firebase","auth","signInWithEmailAndPassword","email","password","then","success","name","displayName","id","uid","sessionStorage","setItem","alert","go","bind","catch","error","errorCode","code","errorMessage","message","returnCurrentUser","logout","self","signOut","removeItem","console","log","findImages","searchPtrn","database","ref","child","once","allUsers","filteredImgArr","key","img","images","tags","some","push","filterImages","val","init","center","lat","lng","map","google","maps","Map","document","getElementById","zoom","styles","featureType","elementType","stylers","color","visibility","weight","Marker","position","shareInFB","photo","FB","ui","method","href","imageUrl","response","recievePhoto","currentPhoto","uploadPhotoToFirebase","tagsArr","photoName","s4","Math","floor","random","toString","substring","guid","userId","getItem","userName","storage","put","imageData","metadata","downloadURLs","imageName","owner","ownerName","ownerId","likes","numLikes","imageId","set","setAvatar","myAvatar","avatarPhoto","image","pos","indexOf","type","b64","substr","imageContent","atob","buffer","ArrayBuffer","length","view","Uint8Array","n","charCodeAt","blob","Blob","base64ToBlob","userRef","userAvatar","avatarUrl","update","component","bindings","heading","hide","template","uploadPhotoService","$onInit","uploadPhoto","showToast","isShowToast","$scope","Authentification","authForm","reset","ifToastToShow","ifToastShow","$location","Sharing","userImagesRef","on","userPhotos","Object","values","reverse","$$phase","$digest","avatar","deleteImage","remove","delete","goToImagePage","path","hideUploadPhotoModal","uploadPhotoModal","showUploadPhotoModal","showAddAvatarModal","addAvatarModal","hideAddAvatarModal","toggleShareBlock","element","isShareBlockActive","hideOnLeave","shareFB","sendComplaint","complaint","complaintsRef","complaintObj","userEmail","subject","messageText","complaintForm","allImagesArr","imagesObj","key1","sort","setLike","isLike","imageOwnerId","likesObj","likesNumber","Carousel","users","$stateParams","imageRef","avatarRef","goToUserPage","addUser","newUser","createUserWithEmailAndPassword","uId","usersRef","userObj","updateProfile","nickname","regForm","createRetypePassRegexp","retypePassRegexp","RegExp","FindImgService","emailRegexp","toggleBurger","event","isBurgerActive","stopPropagation","searchTags","encodeURI","decodeURI","data","searchedImages","directive","restrict","link","scope","reader","files","FileReader","onload","$apply","target","result","readAsDataURL"],"mappings":"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","file":"app.js","sourcesContent":["var appModule = angular.module('appModule', ['ui.router', 'angular.chips', 'ngImgCrop', 'angular-carousel']);\r\n\r\nappModule.config(['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {\r\n\r\n    $stateProvider\r\n        //Main page\r\n        .state('home', {\r\n            url: '/home',\r\n            templateUrl: 'views/home.html',\r\n            controller: 'homeCtrl'\r\n        })\r\n        //Gallery\r\n        .state('gallery', {\r\n            url: '/gallery',\r\n            templateUrl: 'views/gallery.html',\r\n            controller: 'galleryCtrl'\r\n        })\r\n        //Image page\r\n        .state('image', {\r\n            url: '/image/{userId}/{imageId}',\r\n            templateUrl: 'views/image.html',\r\n            controller: 'imageCtrl'\r\n        })\r\n        //Search page\r\n        .state('search', {\r\n            url:'/search/{searchPtrn}',\r\n            templateUrl: 'views/search.html',\r\n            controller: 'searchCtrl'\r\n        })\r\n        //User`s page\r\n        .state('user', {\r\n            url: '/user/{userId}',\r\n            templateUrl: 'views/user.html',\r\n            controller: 'userCtrl'\r\n        })\r\n        //Registration\r\n        .state('registration', {\r\n            url: '/registration',\r\n            templateUrl: 'views/registration.html',\r\n            controller: 'registrationCtrl'\r\n        })\r\n        //Authorization\r\n        .state('authorization', {\r\n            url: '/authorization',\r\n            templateUrl: 'views/authorization.html',\r\n            controller: 'authorizationCtrl'\r\n        })\r\n        //User`s cabinet\r\n        .state('cabinet', {\r\n            url: '/cabinet',\r\n            templateUrl: 'views/cabinet.html',\r\n            controller: 'cabinetCtrl'\r\n        })\r\n        //Contacts\r\n        .state('contacts', {\r\n            url: '/contacts',\r\n            templateUrl: 'views/contacts.html',\r\n            controller: 'contactsCtrl'\r\n        })\r\n        //About\r\n        .state('about', {\r\n            url: '/about',\r\n            templateUrl: 'views/about.html',\r\n            controller: 'aboutCtrl'\r\n        });\r\n        //In other cases\r\n        $urlRouterProvider.otherwise('/home');\r\n\r\n}]);\r\n\r\n","appModule.service('Authentification', function($state) {\r\n    // Initialize user`s object\r\n    this.currentUser = {};\r\n    this.authUser = function(user) {\r\n        function writeData(success) {\r\n            //Get current user\r\n            this.currentUser.name = success.displayName;\r\n            this.currentUser.id = success.uid;\r\n            \r\n            // Write current user data in Session Storage\r\n            sessionStorage.setItem('currentUserName', this.currentUser.name);\r\n            sessionStorage.setItem('currentUserId', this.currentUser.id);\r\n            \r\n            alert('Authentification successed. Now - cabinet');\r\n            $state.go('cabinet');            \r\n        }\r\n\r\n        firebase.auth().signInWithEmailAndPassword(user.email, user.password).then(writeData.bind(this))\r\n        .catch(function(error) {\r\n            //Handle errors            \r\n            var errorCode = error.code;\r\n            var errorMessage = error.message;\r\n\r\n            if(errorCode === 'auth/invalid-email') {\r\n                return alert(errorMessage);\r\n            } else if (errorCode === 'auth/user-disabled') {\r\n                return alert(errorMessage);\r\n            } else if(errorCode === 'auth/user-not-found') {\r\n                return alert(errorMessage);\r\n            } else if(errorCode === 'auth/wrong-password') {\r\n                return alert(errorMessage);\r\n            }         \r\n        });\r\n    };\r\n\r\n    this.returnCurrentUser = function() {\r\n        return this.currentUser;\r\n    };\r\n\r\n    //Logout\r\n    this.logout = function() {\r\n        var self = this;\r\n        firebase.auth().signOut().then(function() {\r\n            sessionStorage.removeItem('currentUserName');\r\n            sessionStorage.removeItem('currentUserId');\r\n            self.currentUser.name = '';\r\n            alert('Sign out success');\r\n            $state.go('home');\r\n        }).catch(function(error) {\r\n            return console.log(error);\r\n        });\r\n    };\r\n});","appModule.service('FindImgService', function () {\r\n\r\n    this.findImages = function (searchPtrn) {\r\n        // Filtering images \r\n        var allUserRef = firebase.database().ref().child('Users');\r\n\r\n        // get images by tags\r\n        function filterImages(allUsers) {\r\n            var filteredImgArr = [];\r\n            for (var key in allUsers) {\r\n                for (img in allUsers[key].images) {\r\n                    if (allUsers[key].images[img].tags.some(img => img == searchPtrn)) {\r\n                        filteredImgArr.push(allUsers[key].images[img]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return filteredImgArr;\r\n        }  \r\n\r\n        // get all users\r\n        return allUserRef.once('value').then(function(success) {\r\n            var allUsers = success.val();\r\n            return filterImages(allUsers);\r\n        });\r\n        \r\n    }\r\n});","appModule.service('Map', function() {\r\n    this.init = function() {\r\n        var center = { \r\n            lat: 50.447941, \r\n            lng: 30.451600 \r\n        };\r\n\r\n        var map = new google.maps.Map(document.getElementById('map'), {\r\n            zoom: 15,\r\n            center: center,\r\n            styles: [{\"featureType\":\"water\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#d3d3d3\"}]},{\"featureType\":\"transit\",\"stylers\":[{\"color\":\"#808080\"},{\"visibility\":\"off\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#b3b3b3\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"}]},{\"featureType\":\"road.local\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#ffffff\"},{\"weight\":1.8}]},{\"featureType\":\"road.local\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#d7d7d7\"}]},{\"featureType\":\"poi\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#ebebeb\"}]},{\"featureType\":\"administrative\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#a7a7a7\"}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"}]},{\"featureType\":\"landscape\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#efefef\"}]},{\"featureType\":\"road\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#696969\"}]},{\"featureType\":\"administrative\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#737373\"}]},{\"featureType\":\"poi\",\"elementType\":\"labels.icon\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"poi\",\"elementType\":\"labels\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#d6d6d6\"}]},{\"featureType\":\"road\",\"elementType\":\"labels.icon\",\"stylers\":[{\"visibility\":\"off\"}]},{},{\"featureType\":\"poi\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#dadada\"}]}]\r\n        });\r\n\r\n        var marker = new google.maps.Marker({\r\n            position: center,\r\n            map: map\r\n        });\r\n    };\r\n});","appModule.service('Sharing', function(){\r\n    this.shareInFB = function(photo) {\r\n        FB.ui({\r\n            method: 'share',\r\n            href: photo.imageUrl, //test url\r\n        }, function(response){\r\n            return console.log(response);\r\n        });\r\n    }; \r\n});","appModule.service('uploadPhotoService', function() {\r\n    var photo; \r\n\r\n    this.recievePhoto = function(currentPhoto) {\r\n       photo = currentPhoto;\r\n    };\r\n\r\n    this.uploadPhotoToFirebase = function(tagsArr) {\r\n        // Generate unique id for file name\r\n        function guid() {\r\n            function s4() {\r\n                return Math.floor((1 + Math.random()) * 0x10000)\r\n                .toString(16)\r\n                .substring(1);\r\n            }\r\n            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n                s4() + '-' + s4() + s4() + s4();\r\n        }\r\n\r\n        // get photo name, imageRef in Firebase\r\n        var photoName = guid();\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var userName = sessionStorage.getItem('currentUserName');\r\n        var imagesRef = firebase.storage().ref('images/' + userId + '/' + photoName);\r\n\r\n        // Upload photo to Firebase Storage\r\n        imagesRef.put(photo).then(function(success) {\r\n            console.log('Uploaded succsesfully');\r\n\r\n            //create image data\r\n            var imageData = {\r\n                imageUrl: success.metadata.downloadURLs[0],\r\n                imageName: success.metadata.name,\r\n                tags: tagsArr,\r\n                owner: {\r\n                    ownerName: userName,\r\n                    ownerId: userId\r\n                },\r\n                likes: {\r\n                    numLikes: 0\r\n                }\r\n            };\r\n            \r\n            writePhotoToDB(imageData);\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n\r\n        // Upload photo to Firebase Database\r\n        function writePhotoToDB(imageData) {\r\n            // Get user`s ref\r\n            var userImagesRef = firebase.database().ref().child('Users').child(userId).child('images');\r\n            \r\n            // Image id in DB\r\n            userImagesRef.push(imageData).then(function(success){\r\n                console.log('Image added to DB successfully');\r\n                // Set image id in DB\r\n                setImageId(success.key);\r\n            }).catch(function(error){\r\n                console.log(error);\r\n            });\r\n        }\r\n\r\n        // Set id for image (the same as branch id)\r\n        function setImageId(imageId) {\r\n            var newImageRef = firebase.database().ref().child('Users').child(userId).child('images').child(imageId).child('id');\r\n            \r\n            newImageRef.set(imageId).then(function(success) {\r\n                console.log('Id set successfully');\r\n            }).catch(function(error) {\r\n                console.log(error);\r\n            });\r\n        } \r\n    };\r\n\r\n    this.setAvatar = function(myAvatar) {\r\n        var avatarPhoto;\r\n        var avatarName = 'avatar';\r\n        \r\n        // convert base64 to blob for uploading to Firebase\r\n        function base64ToBlob(image) {\r\n            // extract content type and base64 payload from original string\r\n            var pos = image.indexOf(';base64,');\r\n            var type = image.substring(5, pos);\r\n            var b64 = image.substr(pos + 8);\r\n          \r\n            // decode base64\r\n            var imageContent = atob(b64);\r\n          \r\n            // create an ArrayBuffer and a view (as unsigned 8-bit)\r\n            var buffer = new ArrayBuffer(imageContent.length);\r\n            var view = new Uint8Array(buffer);\r\n          \r\n            // fill the view, using the decoded base64\r\n            for(var n = 0; n < imageContent.length; n++) {\r\n              view[n] = imageContent.charCodeAt(n);\r\n            }\r\n          \r\n            // convert ArrayBuffer to Blob\r\n            var blob = new Blob([buffer], { type: type });\r\n            \r\n            // get final file\r\n            avatarPhoto = blob;\r\n        }\r\n\r\n        base64ToBlob(myAvatar);\r\n\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var userRef = firebase.database().ref().child('Users');\r\n\r\n        // Get avatars ref in Firebase Storage\r\n        var avatarRef = firebase.storage().ref().child('images/' + userId + '/avatar/' + avatarName);\r\n\r\n        // Set avatar url to Firebase Database\r\n        function setAvatarToDB(avatarUrl) {\r\n            var userAvatar = {\r\n                avatarUrl: avatarUrl\r\n            }\r\n\r\n            userRef.child(userId).update(userAvatar);\r\n        } \r\n\r\n        // Set avatar to Firebase Storage\r\n        avatarRef.put(avatarPhoto).then(function(success) {\r\n            var avatarUrl = success.metadata.downloadURLs[0];\r\n            setAvatarToDB(avatarUrl);\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n\r\n    }\r\n});","appModule.component('addAvatarModal', {\r\n    bindings: {\r\n        heading: '@',\r\n        hide: '&'\r\n    },\r\n    template:\r\n        `<div class=\"modal-bg\" id=\"modal-add-avatar\" ng-click=\"$ctrl.hide()\"> \r\n            <div class=\"modal-content\" ng-click=\"$event.stopPropagation()\">\r\n                <div class=\"modal-header\"> \r\n                    {{ $ctrl.heading }} \r\n                    <div class=\"close-modal\" ng-click=\"$ctrl.hide()\"></div>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div class=\"image-preview\">\r\n                        <input photo-upload type=\"file\" accept=\"image/*\" name=\"newPhoto\" class=\"upload-photo\" id=\"upload-new-photo\">\r\n                        <label for=\"upload-new-photo\" class=\"photo-item\" ng-if=\"!image\">\r\n                            <img src=\"./images/add-image.svg\">\r\n                        </label>\r\n                        <img-crop ng-if=\"image\" image=\"image\" area-type=\"square\" result-image=\"$ctrl.myAvatar\" class=\"photo-item\"></img-crop>\r\n                    </div>                    \r\n                </div>\r\n                <div class=\"modal-controls\">\r\n                    <input type=\"submit\" value=\"Set avatar\" class=\"btn-submit\" ng-click=\"$ctrl.uploadPhoto(); $ctrl.hide()\">\r\n                </div>\r\n            </div>\r\n        </div>`,\r\n    controller: function(uploadPhotoService) {\r\n        this.$onInit = function() {\r\n            // Init avatar slot\r\n            this.myAvatar = '';\r\n        }\r\n        this.uploadPhoto = function() {\r\n            uploadPhotoService.setAvatar(this.myAvatar);\r\n        };\r\n    }\r\n});","appModule.component('popup', {\r\n    bindings: {\r\n        showToast: '='\r\n    },\r\n    template: \r\n       `<div class=\"popup\" ng-if=\"$ctrl.isShowToast\">\r\n            <div class=\"popup-text\">\r\n            </div>\r\n       </div>`,\r\n    controller: function() {\r\n        this.isShowToast = true;\r\n    }\r\n})","appModule.component('uploadPhotoModal', {\r\n    bindings: {\r\n        heading: '@',\r\n        hide: '&'\r\n    },\r\n    template:     \r\n        `<div class=\"modal-bg\" id=\"modal-upload-photo\" ng-click=\"$ctrl.hide()\"> \r\n            <div class=\"modal-content\" ng-click=\"$event.stopPropagation()\">\r\n                <div class=\"modal-header\"> \r\n                    {{ $ctrl.heading }} \r\n                    <div class=\"close-modal\" ng-click=\"$ctrl.hide()\"></div>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div class=\"image-preview\">\r\n                        <input photo-upload type=\"file\" accept=\"image/*\" name=\"newPhoto\" class=\"upload-photo\" id=\"upload-new-photo\">\r\n                        <label for=\"upload-new-photo\" class=\"photo-item\">\r\n                            <img ng-if=\"!image\" src=\"./images/add-image.svg\">\r\n                            <img ng-src=\"{{image}}\" ng-class=\"{'cabinet-photo': image}\">\r\n                        </label>\r\n                    </div>\r\n                    <div class=\"image-tags\">\r\n                        <span class=\"chips-label\">Enter tags:</span>\r\n                        <chips ng-model=\"$ctrl.tags\">\r\n                            <chip-tmpl>\r\n                                <div class=\"default-chip\">\r\n                                    {{chip}}\r\n                                    <div class=\"delete-chip\" remove-chip>\r\n                                    \r\n                                    </div>\r\n                                </div>\r\n                            </chip-tmpl>\r\n                            <input chip-control></input>\r\n                        </chips>\r\n                    </div>\r\n                </div>\r\n                <div class=\"modal-controls\">\r\n                    <input type=\"submit\" value=\"Upload\" class=\"btn-submit\" ng-click=\"$ctrl.uploadPhoto(); $ctrl.hide()\">\r\n                </div>\r\n            </div>\r\n        </div>`,\r\n    controller: function(uploadPhotoService) {\r\n        this.$onInit = function() {\r\n            // Tag`s array\r\n            this.tags = [];\r\n        }\r\n        // Upload photo to Firebase\r\n        this.uploadPhoto = function() {\r\n            uploadPhotoService.uploadPhotoToFirebase(this.tags);\r\n        };\r\n    }\r\n});","appModule.controller('aboutCtrl', ['$scope', function($scope) {\r\n   \r\n}]);","appModule.controller('authorizationCtrl', ['$scope', '$state', 'Authentification', function($scope, $state, Authentification) {\r\n    \r\n    // Login user\r\n    $scope.authUser = function(user) {\r\n        Authentification.authUser(user);\r\n        authForm.reset();\r\n    };\r\n\r\n    $scope.ifToastToShow = function() {\r\n        $scope.ifToastShow = !$scope.ifToastShow;\r\n        console.log($scope.ifToastShow);\r\n    }\r\n\r\n}]);","appModule.controller('cabinetCtrl', ['$scope', '$state', '$location', 'Authentification', 'Sharing', function($scope, $state, $location, Authentification, Sharing) {\r\n    \r\n    // Get user`s images\r\n    if(sessionStorage.length != 0) {\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var userRef = firebase.database().ref().child('Users').child(userId).child('avatarUrl');\r\n        var userImagesRef = firebase.database().ref().child('Users').child(userId).child('images');\r\n    }\r\n\r\n    \r\n    userImagesRef.on('value', function(success) {\r\n        $scope.userPhotos = Object.values(success.val());\r\n        $scope.userPhotos.reverse();\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    });\r\n\r\n    // Get user`s avatar\r\n    userRef.on('value', function(success) {\r\n        $scope.avatar = success.val();\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    })\r\n    \r\n    //Delete image\r\n    $scope.deleteImage = function(photo) {\r\n        // Delete from DB\r\n        userImagesRef.child(photo.id).remove();\r\n        // Delete from Storage\r\n        var imageInStorage = firebase.storage().ref().child('images').child(userId).child(photo.imageName);\r\n        imageInStorage.delete().then(function() {\r\n            console.log('Image deleted successfully');\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n    };\r\n\r\n    // Go to image page\r\n    $scope.goToImagePage = function(photo) {\r\n        $location.path('image/' + userId + '/' + photo.id);\r\n    };\r\n\r\n    //show/hide Upload photo modal\r\n    $scope.hideUploadPhotoModal = function() {\r\n        $scope.uploadPhotoModal = false;\r\n    }\r\n\r\n    $scope.showUploadPhotoModal = function() {\r\n        $scope.uploadPhotoModal = true;\r\n    };\r\n\r\n    //show/hide Add avatar modal\r\n    $scope.showAddAvatarModal = function() {\r\n        $scope.addAvatarModal = true;\r\n    };\r\n\r\n    $scope.hideAddAvatarModal = function() {\r\n        $scope.addAvatarModal = false;\r\n    }\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function(element) {\r\n        element.isShareBlockActive = !element.isShareBlockActive;\r\n    };\r\n\r\n    $scope.hideOnLeave = function(element) {\r\n        element.isShareBlockActive = false;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n    //Logout\r\n    $scope.logout = function() {\r\n        Authentification.logout();\r\n    };\r\n\r\n}]);","appModule.controller('contactsCtrl', ['$scope', 'Map', function ($scope, Map) {\r\n    //Run map\r\n    Map.init();\r\n\r\n    $scope.sendComplaint = function(complaint) {\r\n        //Send complaint\r\n        var complaintsRef = firebase.database().ref().child('Complaints');\r\n        var complaintObj = {\r\n            userName: complaint.name,\r\n            userEmail: complaint.email,\r\n            subject: complaint.subject,\r\n            message: complaint.messageText\r\n        };\r\n\r\n        complaintsRef.push(complaintObj).then(function(success){\r\n            complaintForm.reset();\r\n            alert('Complaint send successfully');\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n    };\r\n}]);","appModule.controller('galleryCtrl', ['$scope', '$location', 'Sharing', 'Authentification', function($scope, $location, Sharing, Authentification) {\r\n    \r\n    var images = firebase.database().ref().child('Users');\r\n\r\n    $scope.allImagesArr = [];\r\n\r\n    // Get all images\r\n    images.once('value', function(success) {\r\n        var user = success.val();\r\n        for(var key in user) {\r\n            var imagesObj = user[key].images;\r\n            for(var key1 in imagesObj) {\r\n                $scope.allImagesArr.push(imagesObj[key1]);\r\n            }\r\n        }\r\n\r\n        // Sort images\r\n        $scope.allImagesArr.sort(function() {\r\n            return 0.5 - Math.random();\r\n        })\r\n    \r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }        \r\n    });\r\n    \r\n    // Like system\r\n    $scope.setLike = function(element, photo) {\r\n        \r\n        element.isLike = !element.isLike;\r\n\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var imageOwnerId = photo.owner.ownerId;\r\n        var imageId = photo.id;\r\n        \r\n        var likesObj = firebase.database().ref().child('Users').child(imageOwnerId).child('images').child(imageId).child('likes');\r\n\r\n        if(element.isLike) {\r\n            //set user`s like\r\n            likesObj.child('likesBy').push(userId);\r\n            likesObj.child('numLikes').once('value', function(success) {\r\n                var numLikes = +success.val();\r\n                ++numLikes;\r\n                likesObj.child('numLikes').set(numLikes);\r\n            })\r\n\r\n        } else {\r\n            //likesObj.child('likesBy').child('-L3P-N-pED9DqutDYr_Z').remove();\r\n            likesObj.child('numLikes').once('value', function(success) {\r\n                var numLikes = +success.val();\r\n                --numLikes;\r\n                likesObj.child('numLikes').set(numLikes);\r\n            })\r\n        }\r\n\r\n\r\n        likesObj.child('numLikes').on('value', function(success) {\r\n            $scope.likesNumber = success.val();\r\n            if(!$scope.$$phase) {\r\n                $scope.$digest();\r\n            }\r\n        })\r\n\r\n        // Listen for changes in likesObj\r\n        // likesObj.child('numLikes').on('value', function(success) {\r\n        //     $scope.likesNumber = success.val();\r\n        //     if(!$scope.$$phase) {\r\n        //         $scope.$digest();\r\n        //     }\r\n        // })\r\n    }\r\n\r\n    // Go to image page\r\n    $scope.goToImagePage = function(photo) {\r\n        $location.path('image/' + photo.owner.ownerId + '/' + photo.id);\r\n    };\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function(element) {\r\n        element.isShareBlockActive = !element.isShareBlockActive;\r\n    };\r\n\r\n    $scope.hideOnLeave = function(element) {\r\n        element.isShareBlockActive = false;\r\n    };\r\n\r\n    // Share photo in Facebook\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n}]);","appModule.controller('homeCtrl', ['$scope', 'Carousel', function ($scope, Carousel) {\r\n    //init Carousel\r\n    $scope.Carousel = Carousel;\r\n\r\n    var users = firebase.database().ref().child('Users');\r\n\r\n    $scope.images = [];\r\n\r\n    // Get all images\r\n    users.once('value').then(function (success) {\r\n        var user = success.val();\r\n        for (var key in user) {\r\n            var imagesObj = user[key].images;\r\n            for (var key1 in imagesObj) {\r\n                $scope.images.push(imagesObj[key1]);\r\n                if (!$scope.$$phase) {\r\n                    $scope.$digest();\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n}]);","appModule.controller('imageCtrl', ['$scope', '$stateParams', '$location', 'Sharing', function($scope, $stateParams, $location, Sharing) {\r\n    // Retrieve image from DB\r\n    var imageRef = firebase.database().ref().child('Users').child($stateParams.userId).child('images').child($stateParams.imageId);\r\n    var avatarRef = firebase.database().ref().child('Users').child($stateParams.userId).child('avatarUrl')\r\n\r\n    // Get image from DB\r\n    imageRef.once('value', function(success) {\r\n        $scope.image = success.val();\r\n        console.log($scope.image);\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    }).catch(function(error) {\r\n        console.log(error);\r\n    });\r\n\r\n    // Get avatar\r\n    avatarRef.once('value', function(success) {\r\n        $scope.avatar = success.val();\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    }).catch(function(error) {\r\n        console.log(error);\r\n    });\r\n\r\n    //Go to user`s page \r\n    $scope.goToUserPage = function(userId) {\r\n        console.log(userId);\r\n        $location.path('user/' + userId);\r\n    };\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function() {\r\n        $scope.isShareBlockActive = !$scope.isShareBlockActive;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n    \r\n}]);","appModule.controller('registrationCtrl', ['$scope', '$state', function($scope, $state) {\r\n    \r\n    // Register user\r\n    $scope.addUser = function(newUser) {\r\n        firebase.auth().createUserWithEmailAndPassword(newUser.email, newUser.password).then(function(success) {\r\n            \r\n            $scope.currentUser = firebase.auth().currentUser;\r\n            var userId = firebase.auth().currentUser.uid;\r\n\r\n            //add user nickname to user object\r\n            $scope.currentUser.updateProfile({\r\n                displayName: newUser.nickname,\r\n            }).then(function() {\r\n                console.log('Username added successfully');\r\n            }).catch(function(error) {\r\n                console.log('Username NOT added');\r\n            });   \r\n\r\n            addUserToDB(userId, newUser.nickname); \r\n            //getData();\r\n\r\n            alert('Register successed. Use authorization to sign in');\r\n            $state.go('authorization');\r\n\r\n        }).catch(function(error) {\r\n            //Handle errors            \r\n            var errorCode = error.code;\r\n            var errorMessage = error.message;\r\n\r\n            if(errorCode === 'auth/email-already-in-use') {\r\n                alert(errorMessage);\r\n            }      \r\n        });   \r\n    };\r\n\r\n    //Create retype password regexp\r\n    $scope.createRetypePassRegexp = function() {\r\n        $scope.retypePassRegexp = new RegExp('^' + $scope.newUser.password + '$');\r\n    };\r\n\r\n    //write user to database\r\n    function addUserToDB(uId, userName) {\r\n        var usersRef = firebase.database().ref().child('Users');\r\n        var userObj = {\r\n            userName: userName\r\n        };      \r\n\r\n        usersRef.child(uId).set(userObj).then(function(success){\r\n            console.log('Child added good');\r\n            regForm.reset();\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n    }\r\n    \r\n}]);","appModule.controller('rootController', ['$scope', '$location', 'Authentification', 'FindImgService', function($scope, $location, Authentification, FindImgService) {\r\n\r\n    //RegExps\r\n    $scope.emailRegexp = /^[-\\w\\+\\.]+@(\\w+\\.)+\\w+$/;\r\n\r\n    //Show/hide burger\r\n    $scope.toggleBurger = function(event) {\r\n        $scope.isBurgerActive = !$scope.isBurgerActive;\r\n        console.log($scope.isBurgerActive);\r\n        event.stopPropagation();\r\n    };\r\n\r\n    $scope.user = {};\r\n\r\n    if(sessionStorage.length != 0) {\r\n        $scope.user.name = sessionStorage.getItem('currentUserName');\r\n        $scope.user.id = sessionStorage.getItem('currentUserId');\r\n    } else {\r\n        $scope.user = Authentification.returnCurrentUser();\r\n    }\r\n\r\n    // Image search\r\n    $scope.findImages = function() {\r\n        var searchTags = encodeURI($scope.searchTags);\r\n        $location.path('/search/' + searchTags);\r\n        $scope.searchTags = '';\r\n    }\r\n\r\n}]);","appModule.controller('searchCtrl', ['$scope', '$stateParams', '$location', 'FindImgService', 'Sharing', function($scope, $stateParams, $location, FindImgService, Sharing) {\r\n    \r\n    var searchTags = decodeURI($stateParams.searchPtrn);\r\n\r\n    FindImgService.findImages(searchTags).then(function(data) {\r\n       \r\n        $scope.searchedImages = data;\r\n\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    })\r\n\r\n    //Go to user`s page \r\n    $scope.goToUserPage = function(userId) {\r\n        $location.path('user/' + userId);\r\n    };\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function() {\r\n        $scope.isShareBlockActive = !$scope.isShareBlockActive;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n}])","appModule.controller('userCtrl', ['$scope', '$stateParams', 'Sharing', function($scope, $stateParams, Sharing) {\r\n    var userRef = firebase.database().ref().child('Users').child($stateParams.userId);\r\n\r\n    // Get user name\r\n    userRef.child('userName').once('value', function(success) {\r\n        $scope.userName = success.val();\r\n        console.log(success.val());  \r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    });\r\n\r\n    // Get user`s avatar\r\n    userRef.child('avatarUrl').once('value', function(success) {\r\n        $scope.avatar = success.val();\r\n    })\r\n\r\n    // Get user images\r\n    userRef.child('images').once('value', function(success) {\r\n        $scope.userPhotos = Object.values(success.val());\r\n        console.log($scope.userPhotos);\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    });\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function(element) {\r\n        element.isShareBlockActive = !element.isShareBlockActive;\r\n    };\r\n\r\n    $scope.hideOnLeave = function(element) {\r\n        element.isShareBlockActive = false;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n}]);\r\n","appModule.directive('photoUpload', ['uploadPhotoService', function(uploadPhotoService) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element) {\r\n            element.on('change', function(event) {\r\n                getPhoto();\r\n            });\r\n\r\n            function getPhoto() {\r\n                // Get photo and name, image ref in firebase\r\n                var currentPhoto = element[0].files[0];\r\n                \r\n                var reader = new FileReader();\r\n\r\n                //show image\r\n                reader.onload = function(event) {\r\n                    scope.$apply(function(scope) {\r\n                        scope.image = event.target.result;\r\n                    });\r\n                };\r\n                \r\n                reader.readAsDataURL(currentPhoto);\r\n\r\n                uploadPhotoService.recievePhoto(currentPhoto);\r\n\r\n            }\r\n        }\r\n    };\r\n}]);"],"sourceRoot":"/source/"}