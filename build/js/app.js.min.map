{"version":3,"sources":["add-avatar-modal.js","popup.js","upload-photo-modal.js","about-controller.js","authorization-controller.js","cabinet-controller.js","contacts-controller.js","gallery-controller.js","home-controller.js","image-controller.js","registration-controller.js","root-controller.js","search-controller.js","user-controller.js","upload-photo.js","authentification.js","findImagesService.js","map.js","sharing.js","uploadPhotoService.js","app-module.js"],"names":["appModule","component","bindings","heading","hide","template","controller","uploadPhotoService","this","$onInit","myAvatar","uploadPhoto","setAvatar","showToast","isShowToast","tags","uploadPhotoToFirebase","$scope","$state","Authentification","authUser","user","authForm","reset","ifToastToShow","ifToastShow","console","log","$location","Sharing","sessionStorage","length","userId","getItem","userRef","firebase","database","ref","child","userImagesRef","on","success","userPhotos","Object","values","val","reverse","$$phase","$digest","avatar","deleteImage","photo","id","remove","storage","imageName","delete","then","catch","error","goToImagePage","path","hideUploadPhotoModal","uploadPhotoModal","showUploadPhotoModal","showAddAvatarModal","addAvatarModal","hideAddAvatarModal","toggleShareBlock","element","isShareBlockActive","hideOnLeave","shareFB","shareInFB","logout","Map","init","sendComplaint","complaint","complaintsRef","complaintObj","userName","name","userEmail","email","subject","message","messageText","push","complaintForm","alert","images","allImagesArr","once","key","imagesObj","key1","sort","Math","random","setLike","isLike","imageOwnerId","owner","ownerId","imageId","likesObj","numLikes","set","likesNumber","Carousel","users","$stateParams","imageRef","avatarRef","image","goToUserPage","addUser","newUser","auth","createUserWithEmailAndPassword","password","currentUser","uId","usersRef","userObj","uid","updateProfile","displayName","nickname","regForm","go","errorCode","code","errorMessage","createRetypePassRegexp","retypePassRegexp","RegExp","FindImgService","emailRegexp","toggleBurger","event","isBurgerActive","stopPropagation","returnCurrentUser","findImages","searchTags","encodeURI","decodeURI","searchPtrn","data","searchedImages","directive","restrict","link","scope","currentPhoto","reader","files","FileReader","onload","$apply","target","result","readAsDataURL","recievePhoto","service","signInWithEmailAndPassword","setItem","bind","self","signOut","removeItem","allUsers","filteredImgArr","img","some","filterImages","center","lat","lng","map","google","maps","document","getElementById","zoom","styles","featureType","elementType","stylers","color","visibility","weight","Marker","position","FB","ui","method","href","imageUrl","response","tagsArr","photoName","s4","floor","toString","substring","guid","put","imageData","metadata","downloadURLs","ownerName","likes","avatarPhoto","pos","indexOf","type","b64","substr","imageContent","atob","buffer","ArrayBuffer","view","Uint8Array","n","charCodeAt","blob","Blob","base64ToBlob","userAvatar","avatarUrl","update","angular","module","config","$stateProvider","$urlRouterProvider","state","url","templateUrl","otherwise"],"mappings":"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","file":"app.js","sourcesContent":["appModule.component('addAvatarModal', {\r\n    bindings: {\r\n        heading: '@',\r\n        hide: '&'\r\n    },\r\n    template:\r\n        `<div class=\"modal-bg\" id=\"modal-add-avatar\" ng-click=\"$ctrl.hide()\"> \r\n            <div class=\"modal-content\" ng-click=\"$event.stopPropagation()\">\r\n                <div class=\"modal-header\"> \r\n                    {{ $ctrl.heading }} \r\n                    <div class=\"close-modal\" ng-click=\"$ctrl.hide()\"></div>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div class=\"image-preview\">\r\n                        <input photo-upload type=\"file\" accept=\"image/*\" name=\"newPhoto\" class=\"upload-photo\" id=\"upload-new-photo\">\r\n                        <label for=\"upload-new-photo\" class=\"photo-item\" ng-if=\"!image\">\r\n                            <img src=\"./images/add-image.svg\">\r\n                        </label>\r\n                        <img-crop ng-if=\"image\" image=\"image\" area-type=\"square\" result-image=\"$ctrl.myAvatar\" class=\"photo-item\"></img-crop>\r\n                    </div>                    \r\n                </div>\r\n                <div class=\"modal-controls\">\r\n                    <input type=\"submit\" value=\"Set avatar\" class=\"btn-submit\" ng-click=\"$ctrl.uploadPhoto(); $ctrl.hide()\">\r\n                </div>\r\n            </div>\r\n        </div>`,\r\n    controller: function(uploadPhotoService) {\r\n        this.$onInit = function() {\r\n            // Init avatar slot\r\n            this.myAvatar = '';\r\n        }\r\n        this.uploadPhoto = function() {\r\n            uploadPhotoService.setAvatar(this.myAvatar);\r\n        };\r\n    }\r\n});","appModule.component('popup', {\r\n    bindings: {\r\n        showToast: '='\r\n    },\r\n    template: \r\n       `<div class=\"popup\" ng-if=\"$ctrl.isShowToast\">\r\n            <div class=\"popup-text\">\r\n            </div>\r\n       </div>`,\r\n    controller: function() {\r\n        this.isShowToast = true;\r\n    }\r\n})","appModule.component('uploadPhotoModal', {\r\n    bindings: {\r\n        heading: '@',\r\n        hide: '&'\r\n    },\r\n    template:     \r\n        `<div class=\"modal-bg\" id=\"modal-upload-photo\" ng-click=\"$ctrl.hide()\"> \r\n            <div class=\"modal-content\" ng-click=\"$event.stopPropagation()\">\r\n                <div class=\"modal-header\"> \r\n                    {{ $ctrl.heading }} \r\n                    <div class=\"close-modal\" ng-click=\"$ctrl.hide()\"></div>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                    <div class=\"image-preview\">\r\n                        <input photo-upload type=\"file\" accept=\"image/*\" name=\"newPhoto\" class=\"upload-photo\" id=\"upload-new-photo\">\r\n                        <label for=\"upload-new-photo\" class=\"photo-item\">\r\n                            <img ng-if=\"!image\" src=\"./images/add-image.svg\">\r\n                            <img ng-src=\"{{image}}\" ng-class=\"{'cabinet-photo': image}\">\r\n                        </label>\r\n                    </div>\r\n                    <div class=\"image-tags\">\r\n                        <span class=\"chips-label\">Enter tags:</span>\r\n                        <chips ng-model=\"$ctrl.tags\">\r\n                            <chip-tmpl>\r\n                                <div class=\"default-chip\">\r\n                                    {{chip}}\r\n                                    <div class=\"delete-chip\" remove-chip>\r\n                                    \r\n                                    </div>\r\n                                </div>\r\n                            </chip-tmpl>\r\n                            <input chip-control></input>\r\n                        </chips>\r\n                    </div>\r\n                </div>\r\n                <div class=\"modal-controls\">\r\n                    <input type=\"submit\" value=\"Upload\" class=\"btn-submit\" ng-click=\"$ctrl.uploadPhoto(); $ctrl.hide()\">\r\n                </div>\r\n            </div>\r\n        </div>`,\r\n    controller: function(uploadPhotoService) {\r\n        this.$onInit = function() {\r\n            // Tag`s array\r\n            this.tags = [];\r\n        }\r\n        // Upload photo to Firebase\r\n        this.uploadPhoto = function() {\r\n            uploadPhotoService.uploadPhotoToFirebase(this.tags);\r\n        };\r\n    }\r\n});","appModule.controller('aboutCtrl', ['$scope', function($scope) {\r\n   \r\n}]);","appModule.controller('authorizationCtrl', ['$scope', '$state', 'Authentification', function($scope, $state, Authentification) {\r\n    \r\n    // Login user\r\n    $scope.authUser = function(user) {\r\n        Authentification.authUser(user);\r\n        authForm.reset();\r\n    };\r\n\r\n    $scope.ifToastToShow = function() {\r\n        $scope.ifToastShow = !$scope.ifToastShow;\r\n        console.log($scope.ifToastShow);\r\n    }\r\n\r\n}]);","appModule.controller('cabinetCtrl', ['$scope', '$state', '$location', 'Authentification', 'Sharing', function($scope, $state, $location, Authentification, Sharing) {\r\n    \r\n    // Get user`s images\r\n    if(sessionStorage.length != 0) {\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var userRef = firebase.database().ref().child('Users').child(userId).child('avatarUrl');\r\n        var userImagesRef = firebase.database().ref().child('Users').child(userId).child('images');\r\n    }\r\n\r\n    \r\n    userImagesRef.on('value', function(success) {\r\n        $scope.userPhotos = Object.values(success.val());\r\n        $scope.userPhotos.reverse();\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    });\r\n\r\n    // Get user`s avatar\r\n    userRef.on('value', function(success) {\r\n        $scope.avatar = success.val();\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    })\r\n    \r\n    //Delete image\r\n    $scope.deleteImage = function(photo) {\r\n        // Delete from DB\r\n        userImagesRef.child(photo.id).remove();\r\n        // Delete from Storage\r\n        var imageInStorage = firebase.storage().ref().child('images').child(userId).child(photo.imageName);\r\n        imageInStorage.delete().then(function() {\r\n            console.log('Image deleted successfully');\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n    };\r\n\r\n    // Go to image page\r\n    $scope.goToImagePage = function(photo) {\r\n        $location.path('image/' + userId + '/' + photo.id);\r\n    };\r\n\r\n    //show/hide Upload photo modal\r\n    $scope.hideUploadPhotoModal = function() {\r\n        $scope.uploadPhotoModal = false;\r\n    }\r\n\r\n    $scope.showUploadPhotoModal = function() {\r\n        $scope.uploadPhotoModal = true;\r\n    };\r\n\r\n    //show/hide Add avatar modal\r\n    $scope.showAddAvatarModal = function() {\r\n        $scope.addAvatarModal = true;\r\n    };\r\n\r\n    $scope.hideAddAvatarModal = function() {\r\n        $scope.addAvatarModal = false;\r\n    }\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function(element) {\r\n        element.isShareBlockActive = !element.isShareBlockActive;\r\n    };\r\n\r\n    $scope.hideOnLeave = function(element) {\r\n        element.isShareBlockActive = false;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n    //Logout\r\n    $scope.logout = function() {\r\n        Authentification.logout();\r\n    };\r\n\r\n}]);","appModule.controller('contactsCtrl', ['$scope', 'Map', function ($scope, Map) {\r\n    //Run map\r\n    Map.init();\r\n\r\n    $scope.sendComplaint = function(complaint) {\r\n        //Send complaint\r\n        var complaintsRef = firebase.database().ref().child('Complaints');\r\n        var complaintObj = {\r\n            userName: complaint.name,\r\n            userEmail: complaint.email,\r\n            subject: complaint.subject,\r\n            message: complaint.messageText\r\n        };\r\n\r\n        complaintsRef.push(complaintObj).then(function(success){\r\n            complaintForm.reset();\r\n            alert('Complaint send successfully');\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n    };\r\n}]);","appModule.controller('galleryCtrl', ['$scope', '$location', 'Sharing', 'Authentification', function($scope, $location, Sharing, Authentification) {\r\n    \r\n    var images = firebase.database().ref().child('Users');\r\n\r\n    $scope.allImagesArr = [];\r\n\r\n    // Get all images\r\n    images.once('value', function(success) {\r\n        var user = success.val();\r\n        for(var key in user) {\r\n            var imagesObj = user[key].images;\r\n            for(var key1 in imagesObj) {\r\n                $scope.allImagesArr.push(imagesObj[key1]);\r\n            }\r\n        }\r\n\r\n        // Sort images\r\n        $scope.allImagesArr.sort(function() {\r\n            return 0.5 - Math.random();\r\n        })\r\n    \r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }        \r\n    });\r\n    \r\n    // Like system\r\n    $scope.setLike = function(element, photo) {\r\n        \r\n        element.isLike = !element.isLike;\r\n\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var imageOwnerId = photo.owner.ownerId;\r\n        var imageId = photo.id;\r\n        \r\n        var likesObj = firebase.database().ref().child('Users').child(imageOwnerId).child('images').child(imageId).child('likes');\r\n\r\n        if(element.isLike) {\r\n            //set user`s like\r\n            likesObj.child('likesBy').push(userId);\r\n            likesObj.child('numLikes').once('value', function(success) {\r\n                var numLikes = +success.val();\r\n                ++numLikes;\r\n                likesObj.child('numLikes').set(numLikes);\r\n            })\r\n\r\n        } else {\r\n            //likesObj.child('likesBy').child('-L3P-N-pED9DqutDYr_Z').remove();\r\n            likesObj.child('numLikes').once('value', function(success) {\r\n                var numLikes = +success.val();\r\n                --numLikes;\r\n                likesObj.child('numLikes').set(numLikes);\r\n            })\r\n        }\r\n\r\n\r\n        likesObj.child('numLikes').on('value', function(success) {\r\n            $scope.likesNumber = success.val();\r\n            if(!$scope.$$phase) {\r\n                $scope.$digest();\r\n            }\r\n        })\r\n\r\n        // Listen for changes in likesObj\r\n        // likesObj.child('numLikes').on('value', function(success) {\r\n        //     $scope.likesNumber = success.val();\r\n        //     if(!$scope.$$phase) {\r\n        //         $scope.$digest();\r\n        //     }\r\n        // })\r\n    }\r\n\r\n    // Go to image page\r\n    $scope.goToImagePage = function(photo) {\r\n        $location.path('image/' + photo.owner.ownerId + '/' + photo.id);\r\n    };\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function(element) {\r\n        element.isShareBlockActive = !element.isShareBlockActive;\r\n    };\r\n\r\n    $scope.hideOnLeave = function(element) {\r\n        element.isShareBlockActive = false;\r\n    };\r\n\r\n    // Share photo in Facebook\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n}]);","appModule.controller('homeCtrl', ['$scope', 'Carousel', function ($scope, Carousel) {\r\n    //init Carousel\r\n    $scope.Carousel = Carousel;\r\n\r\n    var users = firebase.database().ref().child('Users');\r\n\r\n    $scope.images = [];\r\n\r\n    // Get all images\r\n    users.once('value').then(function (success) {\r\n        var user = success.val();\r\n        for (var key in user) {\r\n            var imagesObj = user[key].images;\r\n            for (var key1 in imagesObj) {\r\n                $scope.images.push(imagesObj[key1]);\r\n                if (!$scope.$$phase) {\r\n                    $scope.$digest();\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n}]);","appModule.controller('imageCtrl', ['$scope', '$stateParams', '$location', 'Sharing', function($scope, $stateParams, $location, Sharing) {\r\n    // Retrieve image from DB\r\n    var imageRef = firebase.database().ref().child('Users').child($stateParams.userId).child('images').child($stateParams.imageId);\r\n    var avatarRef = firebase.database().ref().child('Users').child($stateParams.userId).child('avatarUrl')\r\n\r\n    // Get image from DB\r\n    imageRef.once('value', function(success) {\r\n        $scope.image = success.val();\r\n        console.log($scope.image);\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    }).catch(function(error) {\r\n        console.log(error);\r\n    });\r\n\r\n    // Get avatar\r\n    avatarRef.once('value', function(success) {\r\n        $scope.avatar = success.val();\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    }).catch(function(error) {\r\n        console.log(error);\r\n    });\r\n\r\n    //Go to user`s page \r\n    $scope.goToUserPage = function(userId) {\r\n        console.log(userId);\r\n        $location.path('user/' + userId);\r\n    };\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function() {\r\n        $scope.isShareBlockActive = !$scope.isShareBlockActive;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n    \r\n}]);","appModule.controller('registrationCtrl', ['$scope', '$state', function($scope, $state) {\r\n    \r\n    // Register user\r\n    $scope.addUser = function(newUser) {\r\n        firebase.auth().createUserWithEmailAndPassword(newUser.email, newUser.password).then(function(success) {\r\n            \r\n            $scope.currentUser = firebase.auth().currentUser;\r\n            var userId = firebase.auth().currentUser.uid;\r\n\r\n            //add user nickname to user object\r\n            $scope.currentUser.updateProfile({\r\n                displayName: newUser.nickname,\r\n            }).then(function() {\r\n                console.log('Username added successfully');\r\n            }).catch(function(error) {\r\n                console.log('Username NOT added');\r\n            });   \r\n\r\n            addUserToDB(userId, newUser.nickname); \r\n            //getData();\r\n\r\n            alert('Register successed. Use authorization to sign in');\r\n            $state.go('authorization');\r\n\r\n        }).catch(function(error) {\r\n            //Handle errors            \r\n            var errorCode = error.code;\r\n            var errorMessage = error.message;\r\n\r\n            if(errorCode === 'auth/email-already-in-use') {\r\n                alert(errorMessage);\r\n            }      \r\n        });   \r\n    };\r\n\r\n    //Create retype password regexp\r\n    $scope.createRetypePassRegexp = function() {\r\n        $scope.retypePassRegexp = new RegExp('^' + $scope.newUser.password + '$');\r\n    };\r\n\r\n    //write user to database\r\n    function addUserToDB(uId, userName) {\r\n        var usersRef = firebase.database().ref().child('Users');\r\n        var userObj = {\r\n            userName: userName\r\n        };      \r\n\r\n        usersRef.child(uId).set(userObj).then(function(success){\r\n            console.log('Child added good');\r\n            regForm.reset();\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n    }\r\n    \r\n}]);","appModule.controller('rootController', ['$scope', '$location', 'Authentification', 'FindImgService', function($scope, $location, Authentification, FindImgService) {\r\n\r\n    //RegExps\r\n    $scope.emailRegexp = /^[-\\w\\+\\.]+@(\\w+\\.)+\\w+$/;\r\n\r\n    //Show/hide burger\r\n    $scope.toggleBurger = function(event) {\r\n        $scope.isBurgerActive = !$scope.isBurgerActive;\r\n        console.log($scope.isBurgerActive);\r\n        event.stopPropagation();\r\n    };\r\n\r\n    $scope.user = {};\r\n\r\n    if(sessionStorage.length != 0) {\r\n        $scope.user.name = sessionStorage.getItem('currentUserName');\r\n        $scope.user.id = sessionStorage.getItem('currentUserId');\r\n    } else {\r\n        $scope.user = Authentification.returnCurrentUser();\r\n    }\r\n\r\n    // Image search\r\n    $scope.findImages = function() {\r\n        var searchTags = encodeURI($scope.searchTags);\r\n        $location.path('/search/' + searchTags);\r\n        $scope.searchTags = '';\r\n    }\r\n\r\n}]);","appModule.controller('searchCtrl', ['$scope', '$stateParams', '$location', 'FindImgService', 'Sharing', function($scope, $stateParams, $location, FindImgService, Sharing) {\r\n    \r\n    var searchTags = decodeURI($stateParams.searchPtrn);\r\n\r\n    FindImgService.findImages(searchTags).then(function(data) {\r\n       \r\n        $scope.searchedImages = data;\r\n\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    })\r\n\r\n    //Go to user`s page \r\n    $scope.goToUserPage = function(userId) {\r\n        $location.path('user/' + userId);\r\n    };\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function() {\r\n        $scope.isShareBlockActive = !$scope.isShareBlockActive;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n}])","appModule.controller('userCtrl', ['$scope', '$stateParams', 'Sharing', function($scope, $stateParams, Sharing) {\r\n    var userRef = firebase.database().ref().child('Users').child($stateParams.userId);\r\n\r\n    // Get user name\r\n    userRef.child('userName').once('value', function(success) {\r\n        $scope.userName = success.val();\r\n        console.log(success.val());  \r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    });\r\n\r\n    // Get user`s avatar\r\n    userRef.child('avatarUrl').once('value', function(success) {\r\n        $scope.avatar = success.val();\r\n    })\r\n\r\n    // Get user images\r\n    userRef.child('images').once('value', function(success) {\r\n        $scope.userPhotos = Object.values(success.val());\r\n        console.log($scope.userPhotos);\r\n        if(!$scope.$$phase) {\r\n            $scope.$digest();\r\n        }\r\n    });\r\n\r\n    //Show/Hide share block\r\n    $scope.toggleShareBlock = function(element) {\r\n        element.isShareBlockActive = !element.isShareBlockActive;\r\n    };\r\n\r\n    $scope.hideOnLeave = function(element) {\r\n        element.isShareBlockActive = false;\r\n    };\r\n\r\n    // FB sharing\r\n    $scope.shareFB = function(photo) {\r\n        Sharing.shareInFB(photo);\r\n    };\r\n\r\n}]);\r\n","appModule.directive('photoUpload', ['uploadPhotoService', function(uploadPhotoService) {\r\n    return {\r\n        restrict: 'A',\r\n        link: function(scope, element) {\r\n            element.on('change', function(event) {\r\n                getPhoto();\r\n            });\r\n\r\n            function getPhoto() {\r\n                // Get photo and name, image ref in firebase\r\n                var currentPhoto = element[0].files[0];\r\n                \r\n                var reader = new FileReader();\r\n\r\n                //show image\r\n                reader.onload = function(event) {\r\n                    scope.$apply(function(scope) {\r\n                        scope.image = event.target.result;\r\n                    });\r\n                };\r\n                \r\n                reader.readAsDataURL(currentPhoto);\r\n\r\n                uploadPhotoService.recievePhoto(currentPhoto);\r\n\r\n            }\r\n        }\r\n    };\r\n}]);","appModule.service('Authentification', function($state) {\r\n    // Initialize user`s object\r\n    this.currentUser = {};\r\n    this.authUser = function(user) {\r\n        function writeData(success) {\r\n            //Get current user\r\n            this.currentUser.name = success.displayName;\r\n            this.currentUser.id = success.uid;\r\n            \r\n            // Write current user data in Session Storage\r\n            sessionStorage.setItem('currentUserName', this.currentUser.name);\r\n            sessionStorage.setItem('currentUserId', this.currentUser.id);\r\n            \r\n            alert('Authentification successed. Now - cabinet');\r\n            $state.go('cabinet');            \r\n        }\r\n\r\n        firebase.auth().signInWithEmailAndPassword(user.email, user.password).then(writeData.bind(this))\r\n        .catch(function(error) {\r\n            //Handle errors            \r\n            var errorCode = error.code;\r\n            var errorMessage = error.message;\r\n\r\n            if(errorCode === 'auth/invalid-email') {\r\n                return alert(errorMessage);\r\n            } else if (errorCode === 'auth/user-disabled') {\r\n                return alert(errorMessage);\r\n            } else if(errorCode === 'auth/user-not-found') {\r\n                return alert(errorMessage);\r\n            } else if(errorCode === 'auth/wrong-password') {\r\n                return alert(errorMessage);\r\n            }         \r\n        });\r\n    };\r\n\r\n    this.returnCurrentUser = function() {\r\n        return this.currentUser;\r\n    };\r\n\r\n    //Logout\r\n    this.logout = function() {\r\n        var self = this;\r\n        firebase.auth().signOut().then(function() {\r\n            sessionStorage.removeItem('currentUserName');\r\n            sessionStorage.removeItem('currentUserId');\r\n            self.currentUser.name = '';\r\n            alert('Sign out success');\r\n            $state.go('home');\r\n        }).catch(function(error) {\r\n            return console.log(error);\r\n        });\r\n    };\r\n});","appModule.service('FindImgService', function () {\r\n\r\n    this.findImages = function (searchPtrn) {\r\n        // Filtering images \r\n        var allUserRef = firebase.database().ref().child('Users');\r\n\r\n        // get images by tags\r\n        function filterImages(allUsers) {\r\n            var filteredImgArr = [];\r\n            for (var key in allUsers) {\r\n                for (img in allUsers[key].images) {\r\n                    if (allUsers[key].images[img].tags.some(img => img == searchPtrn)) {\r\n                        filteredImgArr.push(allUsers[key].images[img]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return filteredImgArr;\r\n        }  \r\n\r\n        // get all users\r\n        return allUserRef.once('value').then(function(success) {\r\n            var allUsers = success.val();\r\n            return filterImages(allUsers);\r\n        });\r\n        \r\n    }\r\n});","appModule.service('Map', function() {\r\n    this.init = function() {\r\n        var center = { \r\n            lat: 50.447941, \r\n            lng: 30.451600 \r\n        };\r\n\r\n        var map = new google.maps.Map(document.getElementById('map'), {\r\n            zoom: 15,\r\n            center: center,\r\n            styles: [{\"featureType\":\"water\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#d3d3d3\"}]},{\"featureType\":\"transit\",\"stylers\":[{\"color\":\"#808080\"},{\"visibility\":\"off\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#b3b3b3\"}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"}]},{\"featureType\":\"road.local\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#ffffff\"},{\"weight\":1.8}]},{\"featureType\":\"road.local\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#d7d7d7\"}]},{\"featureType\":\"poi\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#ebebeb\"}]},{\"featureType\":\"administrative\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#a7a7a7\"}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"}]},{\"featureType\":\"landscape\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#efefef\"}]},{\"featureType\":\"road\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"color\":\"#696969\"}]},{\"featureType\":\"administrative\",\"elementType\":\"labels.text.fill\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#737373\"}]},{\"featureType\":\"poi\",\"elementType\":\"labels.icon\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"poi\",\"elementType\":\"labels\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#d6d6d6\"}]},{\"featureType\":\"road\",\"elementType\":\"labels.icon\",\"stylers\":[{\"visibility\":\"off\"}]},{},{\"featureType\":\"poi\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#dadada\"}]}]\r\n        });\r\n\r\n        var marker = new google.maps.Marker({\r\n            position: center,\r\n            map: map\r\n        });\r\n    };\r\n});","appModule.service('Sharing', function(){\r\n    this.shareInFB = function(photo) {\r\n        FB.ui({\r\n            method: 'share',\r\n            href: photo.imageUrl, //test url\r\n        }, function(response){\r\n            return console.log(response);\r\n        });\r\n    }; \r\n});","appModule.service('uploadPhotoService', function() {\r\n    var photo; \r\n\r\n    this.recievePhoto = function(currentPhoto) {\r\n       photo = currentPhoto;\r\n    };\r\n\r\n    this.uploadPhotoToFirebase = function(tagsArr) {\r\n        // Generate unique id for file name\r\n        function guid() {\r\n            function s4() {\r\n                return Math.floor((1 + Math.random()) * 0x10000)\r\n                .toString(16)\r\n                .substring(1);\r\n            }\r\n            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n                s4() + '-' + s4() + s4() + s4();\r\n        }\r\n\r\n        // get photo name, imageRef in Firebase\r\n        var photoName = guid();\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var userName = sessionStorage.getItem('currentUserName');\r\n        var imagesRef = firebase.storage().ref('images/' + userId + '/' + photoName);\r\n\r\n        // Upload photo to Firebase Storage\r\n        imagesRef.put(photo).then(function(success) {\r\n            console.log('Uploaded succsesfully');\r\n\r\n            //create image data\r\n            var imageData = {\r\n                imageUrl: success.metadata.downloadURLs[0],\r\n                imageName: success.metadata.name,\r\n                tags: tagsArr,\r\n                owner: {\r\n                    ownerName: userName,\r\n                    ownerId: userId\r\n                },\r\n                likes: {\r\n                    numLikes: 0\r\n                }\r\n            };\r\n            \r\n            writePhotoToDB(imageData);\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n\r\n        // Upload photo to Firebase Database\r\n        function writePhotoToDB(imageData) {\r\n            // Get user`s ref\r\n            var userImagesRef = firebase.database().ref().child('Users').child(userId).child('images');\r\n            \r\n            // Image id in DB\r\n            userImagesRef.push(imageData).then(function(success){\r\n                console.log('Image added to DB successfully');\r\n                // Set image id in DB\r\n                setImageId(success.key);\r\n            }).catch(function(error){\r\n                console.log(error);\r\n            });\r\n        }\r\n\r\n        // Set id for image (the same as branch id)\r\n        function setImageId(imageId) {\r\n            var newImageRef = firebase.database().ref().child('Users').child(userId).child('images').child(imageId).child('id');\r\n            \r\n            newImageRef.set(imageId).then(function(success) {\r\n                console.log('Id set successfully');\r\n            }).catch(function(error) {\r\n                console.log(error);\r\n            });\r\n        } \r\n    };\r\n\r\n    this.setAvatar = function(myAvatar) {\r\n        var avatarPhoto;\r\n        var avatarName = 'avatar';\r\n        \r\n        // convert base64 to blob for uploading to Firebase\r\n        function base64ToBlob(image) {\r\n            // extract content type and base64 payload from original string\r\n            var pos = image.indexOf(';base64,');\r\n            var type = image.substring(5, pos);\r\n            var b64 = image.substr(pos + 8);\r\n          \r\n            // decode base64\r\n            var imageContent = atob(b64);\r\n          \r\n            // create an ArrayBuffer and a view (as unsigned 8-bit)\r\n            var buffer = new ArrayBuffer(imageContent.length);\r\n            var view = new Uint8Array(buffer);\r\n          \r\n            // fill the view, using the decoded base64\r\n            for(var n = 0; n < imageContent.length; n++) {\r\n              view[n] = imageContent.charCodeAt(n);\r\n            }\r\n          \r\n            // convert ArrayBuffer to Blob\r\n            var blob = new Blob([buffer], { type: type });\r\n            \r\n            // get final file\r\n            avatarPhoto = blob;\r\n        }\r\n\r\n        base64ToBlob(myAvatar);\r\n\r\n        var userId = sessionStorage.getItem('currentUserId');\r\n        var userRef = firebase.database().ref().child('Users');\r\n\r\n        // Get avatars ref in Firebase Storage\r\n        var avatarRef = firebase.storage().ref().child('images/' + userId + '/avatar/' + avatarName);\r\n\r\n        // Set avatar url to Firebase Database\r\n        function setAvatarToDB(avatarUrl) {\r\n            var userAvatar = {\r\n                avatarUrl: avatarUrl\r\n            }\r\n\r\n            userRef.child(userId).update(userAvatar);\r\n        } \r\n\r\n        // Set avatar to Firebase Storage\r\n        avatarRef.put(avatarPhoto).then(function(success) {\r\n            var avatarUrl = success.metadata.downloadURLs[0];\r\n            setAvatarToDB(avatarUrl);\r\n        }).catch(function(error) {\r\n            console.log(error);\r\n        });\r\n\r\n    }\r\n});","var appModule = angular.module('appModule', ['ui.router', 'angular.chips', 'ngImgCrop', 'angular-carousel']);\r\n\r\nappModule.config(['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {\r\n\r\n    $stateProvider\r\n        //Main page\r\n        .state('home', {\r\n            url: '/home',\r\n            templateUrl: 'views/home.html',\r\n            controller: 'homeCtrl'\r\n        })\r\n        //Gallery\r\n        .state('gallery', {\r\n            url: '/gallery',\r\n            templateUrl: 'views/gallery.html',\r\n            controller: 'galleryCtrl'\r\n        })\r\n        //Image page\r\n        .state('image', {\r\n            url: '/image/{userId}/{imageId}',\r\n            templateUrl: 'views/image.html',\r\n            controller: 'imageCtrl'\r\n        })\r\n        //Search page\r\n        .state('search', {\r\n            url:'/search/{searchPtrn}',\r\n            templateUrl: 'views/search.html',\r\n            controller: 'searchCtrl'\r\n        })\r\n        //User`s page\r\n        .state('user', {\r\n            url: '/user/{userId}',\r\n            templateUrl: 'views/user.html',\r\n            controller: 'userCtrl'\r\n        })\r\n        //Registration\r\n        .state('registration', {\r\n            url: '/registration',\r\n            templateUrl: 'views/registration.html',\r\n            controller: 'registrationCtrl'\r\n        })\r\n        //Authorization\r\n        .state('authorization', {\r\n            url: '/authorization',\r\n            templateUrl: 'views/authorization.html',\r\n            controller: 'authorizationCtrl'\r\n        })\r\n        //User`s cabinet\r\n        .state('cabinet', {\r\n            url: '/cabinet',\r\n            templateUrl: 'views/cabinet.html',\r\n            controller: 'cabinetCtrl'\r\n        })\r\n        //Contacts\r\n        .state('contacts', {\r\n            url: '/contacts',\r\n            templateUrl: 'views/contacts.html',\r\n            controller: 'contactsCtrl'\r\n        })\r\n        //About\r\n        .state('about', {\r\n            url: '/about',\r\n            templateUrl: 'views/about.html',\r\n            controller: 'aboutCtrl'\r\n        });\r\n        //In other cases\r\n        $urlRouterProvider.otherwise('/home');\r\n\r\n}]);\r\n\r\n"]}