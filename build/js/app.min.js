"use strict";appModule.component("addAvatarModal",{bindings:{show:"=",heading:"@"},template:'<div class="modal-bg" id="modal-add-avatar" ng-show="$ctrl.show" ng-click="$ctrl.closeModal()"> \n            <div class="modal-content" ng-click="$event.stopPropagation()">\n                <div class="modal-header"> \n                    {{ $ctrl.heading }} \n                    <div class="close-modal" ng-click="$ctrl.closeModal()"></div>\n                </div>\n                <div class="modal-body">\n                    <div class="image-preview">\n                        <input photo-upload type="file" accept="image/*" name="newPhoto" class="upload-photo" id="upload-new-photo">\n                        <label for="upload-new-photo" class="photo-item">\n                            <img-crop image="image" area-type="square" result-image="$ctrl.myAvatar"></img-crop>\n                        </label>\n                    </div>                    \n                </div>\n                <div class="modal-controls">\n                    <input type="submit" value="Set avatar" class="btn-submit" ng-click="$ctrl.uploadPhoto()">\n                </div>\n            </div>\n        </div>',controller:function(e){this.closeModal=function(){this.show=!1},this.myAvatar="",this.uploadPhoto=function(){e.setAvatar(this.myAvatar)}}}),appModule.component("uploadPhotoModal",{bindings:{show:"=",heading:"@"},template:'<div class="modal-bg" id="modal-upload-photo" ng-show="$ctrl.show" ng-click="$ctrl.closeModal()"> \n            <div class="modal-content" ng-click="$event.stopPropagation()">\n                <div class="modal-header"> \n                    {{ $ctrl.heading }} \n                    <div class="close-modal" ng-click="$ctrl.closeModal()"></div>\n                </div>\n                <div class="modal-body">\n                    <div class="image-preview">\n                        <input photo-upload type="file" accept="image/*" name="newPhoto" class="upload-photo" id="upload-new-photo">\n                        <label for="upload-new-photo" class="photo-item">\n                            <img ng-if="!image" src="./images/add-image.svg">\n                            <img ng-src="{{image}}" ng-class="{\'cabinet-photo\': image}">\n                        </label>\n                    </div>\n                    <div class="image-tags">\n                        <span class="chips-label">Enter tags:</span>\n                        <chips ng-model="$ctrl.tags">\n                            <chip-tmpl>\n                                <div class="default-chip">\n                                    {{chip}}\n                                    <div class="delete-chip" remove-chip>\n                                    \n                                    </div>\n                                </div>\n                            </chip-tmpl>\n                            <input chip-control></input>\n                        </chips>\n                    </div>\n                </div>\n                <div class="modal-controls">\n                    <input type="submit" value="Upload" class="btn-submit" ng-click="$ctrl.uploadPhoto()">\n                </div>\n            </div>\n        </div>',controller:function(e){this.closeModal=function(){this.show=!1},this.tags=[],this.uploadPhoto=function(){e.uploadPhotoToFirebase(this.tags)}}}),appModule.controller("aboutCtrl",["$scope",function(e){}]),appModule.controller("authorizationCtrl",["$scope","$state","Authentification",function(e,t,o){e.authUser=function(e){o.authUser(e)}}]),appModule.controller("cabinetCtrl",["$scope","$state","$location","Authentification","Sharing",function(e,t,o,a,r){if(0!=sessionStorage.length)var i=sessionStorage.getItem("currentUserId"),n=firebase.database().ref().child("Users").child(i).child("images");n.on("value",function(t){e.userPhotos=Object.values(t.val())}),e.deleteImage=function(e){n.child(e.id).remove(),firebase.storage().ref().child("images").child(i).child(e.imageName).delete().then(function(){console.log("Image deleted successfully")}).catch(function(e){console.log(e)})},e.goToImagePage=function(e){o.path("image/"+i+"/"+e.id)},e.showUploadPhotoModal=function(){e.uploadPhotoModal=!0},e.showAddAvatarModal=function(){e.addAvatarModal=!0},e.toggleShareBlock=function(e){e.isShareBlockActive=!e.isShareBlockActive},e.hideOnLeave=function(e){e.isShareBlockActive=!1},e.shareFB=function(e){r.shareInFB(e)},e.logout=function(){a.logout()}}]),appModule.controller("contactsCtrl",["$scope","Map",function(e,t){t.init(),e.sendComplaint=function(e){var t=firebase.database().ref().child("Complaints"),o={userName:e.name,userEmail:e.email,subject:e.subject,message:e.messageText};t.push(o).then(function(e){complaintForm.reset(),alert("Complaint send successfully")}).catch(function(e){console.log(e)})}}]),appModule.controller("galleryCtrl",["$scope","$location","Sharing","Authentification",function(e,t,o,a){var r=firebase.database().ref().child("Users");e.allImagesArr=[],r.once("value",function(t){var o=t.val();for(var a in o){var r=o[a].images;for(var i in r)e.allImagesArr.push(r[i])}}),e.goToImagePage=function(e){t.path("image/"+e.owner.ownerId+"/"+e.id)},e.toggleShareBlock=function(e){e.isShareBlockActive=!e.isShareBlockActive},e.hideOnLeave=function(e){e.isShareBlockActive=!1},e.shareFB=function(e){o.shareInFB(e)}}]),appModule.controller("homeCtrl",["$scope","$http",function(e,t){t({method:"GET",url:"./test_photos/photos.json"}).then(function(t){e.images=t.data},function(e){console.log(e)})}]),appModule.controller("imageCtrl",["$scope","$stateParams","$location","Sharing",function(e,t,o,a){firebase.database().ref().child("Users").child(t.userId).child("images").child(t.imageId).once("value",function(t){e.image=t.val(),console.log(e.image)}).catch(function(e){console.log(e)}),e.goToUserPage=function(e){console.log(e),o.path("user/"+e)},e.toggleShareBlock=function(){e.isShareBlockActive=!e.isShareBlockActive},e.shareFB=function(e){a.shareInFB(e)}}]),appModule.controller("registrationCtrl",["$scope","$state",function(e,t){e.addUser=function(o){firebase.auth().createUserWithEmailAndPassword(o.email,o.password).then(function(a){e.currentUser=firebase.auth().currentUser;var r,i,n,s,l=firebase.auth().currentUser.uid;e.currentUser.updateProfile({displayName:o.nickname}).then(function(){console.log("Username added successfully")}).catch(function(e){console.log("Username NOT added")}),r=l,i=o.nickname,n=firebase.database().ref().child("Users"),s={userName:i},n.child(r).set(s).then(function(e){console.log("Child added good"),regForm.reset()}).catch(function(e){console.log(e)}),alert("Register successed. Use authorization to sign in"),t.go("authorization")}).catch(function(e){var t=e.code,o=e.message;"auth/email-already-in-use"===t&&alert(o)})},e.createRetypePassRegexp=function(){e.retypePassRegexp=new RegExp("^"+e.newUser.password+"$")}}]),appModule.controller("rootController",["$scope","$location","Authentification","FindImgService",function(e,t,o,a){e.emailRegexp=/^[-\w\+\.]+@(\w+\.)+\w+$/,e.toggleBurger=function(t){e.isBurgerActive=!e.isBurgerActive,console.log(e.isBurgerActive),t.stopPropagation()},e.user={},0!=sessionStorage.length?(e.user.name=sessionStorage.getItem("currentUserName"),e.user.id=sessionStorage.getItem("currentUserId")):e.user=o.returnCurrentUser(),e.findImages=function(){var o=encodeURI(e.searchTags);t.path("/search/"+o),e.searchTags=""}}]),appModule.controller("searchCtrl",["$scope","$stateParams","$location","FindImgService","Sharing",function(e,t,o,a,r){var i=decodeURI(t.searchPtrn);e.searchedImages=a.findImages(i),e.goToUserPage=function(e){o.path("user/"+e)},e.toggleShareBlock=function(){e.isShareBlockActive=!e.isShareBlockActive},e.shareFB=function(e){r.shareInFB(e)}}]),appModule.controller("userCtrl",["$scope","$stateParams","Sharing",function(e,t,o){var a=firebase.database().ref().child("Users").child(t.userId);a.child("userName").once("value",function(t){e.userName=t.val(),console.log(t.val())}),a.child("images").once("value",function(t){e.userPhotos=Object.values(t.val()),console.log(e.userPhotos)}),e.toggleShareBlock=function(e){e.isShareBlockActive=!e.isShareBlockActive},e.hideOnLeave=function(e){e.isShareBlockActive=!1},e.shareFB=function(e){o.shareInFB(e)}}]),appModule.directive("photoUpload",["uploadPhotoService",function(e){return{restrict:"A",link:function(t,o){o.on("change",function(a){var r,i;r=o[0].files[0],(i=new FileReader).onload=function(e){t.$apply(function(t){t.image=e.target.result})},i.readAsDataURL(r),e.recievePhoto(r)})}}}]),appModule.service("Authentification",function(e){this.currentUser={},this.authUser=function(t){firebase.auth().signInWithEmailAndPassword(t.email,t.password).then(function(t){this.currentUser.name=t.displayName,this.currentUser.id=t.uid,sessionStorage.setItem("currentUserName",this.currentUser.name),sessionStorage.setItem("currentUserId",this.currentUser.id),authForm.reset(),alert("Authentification successed. Now - cabinet"),e.go("cabinet")}.bind(this)).catch(function(e){var t=e.code,o=e.message;return"auth/invalid-email"===t?alert(o):"auth/user-disabled"===t?alert(o):"auth/user-not-found"===t?alert(o):"auth/wrong-password"===t?alert(o):void 0})},this.returnCurrentUser=function(){return this.currentUser},this.logout=function(){var t=this;firebase.auth().signOut().then(function(){return sessionStorage.removeItem("currentUserName"),sessionStorage.removeItem("currentUserId"),t.currentUser.name="",alert("Sign out succsess"),void e.go("home")}).catch(function(e){return console.log(e)})}}),appModule.service("FindImgService",function(){this.filteredImgArr=[],this.findImages=function(e){var t=this;return firebase.database().ref().child("Users").once("value",function(o){!function(o){for(var a in o)for(img in o[a].images)o[a].images[img].tags.some(function(t){return t==e})&&t.filteredImgArr.push(o[a].images[img])}(o.val())}),t.filteredImgArr}}),appModule.service("Map",function(){this.init=function(){var e={lat:50.447941,lng:30.4516},t=new google.maps.Map(document.getElementById("map"),{zoom:15,center:e,styles:[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#d3d3d3"}]},{featureType:"transit",stylers:[{color:"#808080"},{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#b3b3b3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"},{weight:1.8}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#d7d7d7"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ebebeb"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#a7a7a7"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#efefef"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#696969"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#737373"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dadada"}]}]});new google.maps.Marker({position:e,map:t})}}),appModule.service("Sharing",function(){this.shareInFB=function(e){FB.ui({method:"share",href:e.imageUrl},function(e){return console.log(e)})}}),appModule.service("uploadPhotoService",function(){var e;this.recievePhoto=function(t){e=t,console.log(e)},this.uploadPhotoToFirebase=function(t){var o=e.name,a=sessionStorage.getItem("currentUserId"),r=sessionStorage.getItem("currentUserName");firebase.storage().ref("images/"+a+"/"+o).put(e).then(function(e){console.log("Uploaded succsesfully");var o,i={imageUrl:e.metadata.downloadURLs[0],imageName:e.metadata.name,tags:t,owner:{ownerName:r,ownerId:a}};o=i,firebase.database().ref().child("Users").child(a).child("images").push(o).then(function(e){var t;console.log("Image added to DB successfully"),t=e.key,firebase.database().ref().child("Users").child(a).child("images").child(t).child("id").set(t).then(function(e){console.log("Id set successfully")}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},this.setAvatar=function(t){var o,a=e;!function(e){for(var t=e.indexOf(";base64,"),a=e.substring(5,t),r=e.substr(t+8),i=atob(r),n=new ArrayBuffer(i.length),s=new Uint8Array(n),l=0;l<i.length;l++)s[l]=i.charCodeAt(l);var c=new Blob([n],{type:a});o=c}(t);var r=firebase.storage().ref().child("images/"+userId+"/avatars/bigAvatar"),i=firebase.storage().ref().child("images/"+userId+"/avatars/smallAvatar");r.put(a).then(function(e){bigAvatarUrl=e.metadata.downloadURLs[0]}).catch(function(e){console.log(e)}),i.put(o).then(function(e){e.metadata.downloadURLs[0]}).catch(function(e){console.log(e)})}});var appModule=angular.module("appModule",["ui.router","angular.chips","ngImgCrop","ui.carousel"]);appModule.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/home",templateUrl:"views/home.html",controller:"homeCtrl"}).state("gallery",{url:"/gallery",templateUrl:"views/gallery.html",controller:"galleryCtrl"}).state("image",{url:"/image/{userId}/{imageId}",templateUrl:"views/image.html",controller:"imageCtrl"}).state("search",{url:"/search/{searchPtrn}",templateUrl:"views/search.html",controller:"searchCtrl"}).state("user",{url:"/user/{userId}",templateUrl:"views/user.html",controller:"userCtrl"}).state("registration",{url:"/registration",templateUrl:"views/registration.html",controller:"registrationCtrl"}).state("authorization",{url:"/authorization",templateUrl:"views/authorization.html",controller:"authorizationCtrl"}).state("cabinet",{url:"/cabinet",templateUrl:"views/cabinet.html",controller:"cabinetCtrl"}).state("contacts",{url:"/contacts",templateUrl:"views/contacts.html",controller:"contactsCtrl"}).state("about",{url:"/about",templateUrl:"views/about.html",controller:"aboutCtrl"}),t.otherwise("/home")}]);